<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu - T-Time Café</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>T-Time</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="menu.html">Menu</a></li>
                    <li><a href="login.html">Staff Login</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h2>Our Menu</h2>
        
        <div id="menu-items">
            <!-- Menu items will be loaded here from the database via JavaScript -->
        </div>
    </main>
    <button id="go-to-bottom" class="btn">Go to Bottom</button>

    <div class="cart-container">
        <h2>Your Order</h2>
        <div id="cart-items">
            <!-- Cart items will be displayed here -->
        </div>
        <div class="cart-summary">
            <p>Total: ₹<span id="total-price">0.00</span></p>
            <button id="place-order" class="btn">Place Order</button>
        </div>
    </div>

        <!-- Table Selection Modal -->
        <div id="table-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>Select Your Table</h2>
                <div class="table-selection">
                    <label for="table-number">Table Number:</label>
                    <select id="table-number" name="table-number">
                        <!-- Options 1-20 will be generated by JavaScript -->
                    </select>
                </div>
                <button id="confirm-order" class="btn">Confirm Order</button>
            </div>
        </div>
    <footer>
        <div class="container">
            <p>&copy; 2025 T-Time Café. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- Your Firebase configuration and main script -->
    <script src="js/firebase-config.js"></script>
    <script src="js/main.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuItemsContainer = document.getElementById('menu-items');
            const cartItemsContainer = document.getElementById('cart-items');
            const totalPriceElement = document.getElementById('total-price');
            const placeOrderButton = document.getElementById('place-order');
            const tableModal = document.getElementById('table-modal');
            const closeButton = document.querySelector('.close-button');
            const confirmOrderButton = document.getElementById('confirm-order');
            const tableNumberSelect = document.getElementById('table-number');
            const goToBottomButton = document.getElementById('go-to-bottom');

            let cart = [];

            // Function to scroll to the bottom of the page
            goToBottomButton.addEventListener('click', () => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            });

            // Populate table numbers from 1 to 20
            for (let i = 1; i <= 20; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                tableNumberSelect.appendChild(option);
            }

            // Fetch menu items from Firestore
            db.collection('menu').get().then(querySnapshot => {
                querySnapshot.forEach(doc => {
                    const item = doc.data();
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('menu-item');
                    itemElement.innerHTML = `
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <p class="price">₹${item.price.toFixed(2)}</p>
                        <button class="btn add-to-cart" data-id="${doc.id}" data-name="${item.name}" data-price="${item.price}">Add to Cart</button>
                    `;
                    menuItemsContainer.appendChild(itemElement);
                });
            }).catch(error => {
                console.error("Error fetching menu items: ", error);
                menuItemsContainer.innerHTML = '<p>Could not load menu items. Please try again later.</p>';
            });

            // Add to cart functionality
            menuItemsContainer.addEventListener('click', event => {
                if (event.target.classList.contains('add-to-cart')) {
                    const item = {
                        id: event.target.dataset.id,
                        name: event.target.dataset.name,
                        price: parseFloat(event.target.dataset.price)
                    };
                    cart.push(item);
                    renderCart();
                }
            });

            // Render cart items and update total
            function renderCart() {
                cartItemsContainer.innerHTML = '';
                let totalPrice = 0;
                cart.forEach((item, index) => {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.classList.add('cart-item');
                    cartItemElement.innerHTML = `
                        <span>${item.name}</span>
                        <span>₹${item.price.toFixed(2)}</span>
                        <button class="btn-remove" data-index="${index}">Remove</button>
                    `;
                    cartItemsContainer.appendChild(cartItemElement);
                    totalPrice += item.price;
                });
                totalPriceElement.textContent = totalPrice.toFixed(2);
            }
            
            // Remove from cart
            cartItemsContainer.addEventListener('click', event => {
                if (event.target.classList.contains('btn-remove')) {
                    const index = parseInt(event.target.dataset.index, 10);
                    cart.splice(index, 1);
                    renderCart();
                }
            });

            // Show table selection modal
            placeOrderButton.addEventListener('click', () => {
                if (cart.length === 0) {
                    alert('Your cart is empty.');
                    return;
                }
                tableModal.classList.remove('hidden');
            });

            // Hide modal
            closeButton.addEventListener('click', () => {
                tableModal.classList.add('hidden');
            });
            window.addEventListener('click', event => {
                if (event.target === tableModal) {
                    tableModal.classList.add('hidden');
                }
            });
            
            // Confirm and place order
            confirmOrderButton.addEventListener('click', () => {
                const tableNumber = tableNumberSelect.value;
                if (!tableNumber) {
                    alert('Please select a table number.');
                    return;
                }
                
                const order = {
                    tableNumber: parseInt(tableNumber, 10),
                    items: cart,
                    total: cart.reduce((sum, item) => sum + item.price, 0),
                    status: 'Pending', // Initial status
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };

                db.collection('orders').add(order).then(() => {
                    alert('Order placed successfully!');
                    cart = [];
                    renderCart();
                    tableModal.classList.add('hidden');
                }).catch(error => {
                    console.error('Error placing order:', error);
                    alert('Could not place order. Please try again.');
                });
            });
        });
    </script>
</body>
</html>
